## ToDo List 만들기



지난번 배운 것들을 종합하여 이번에는 ToDo List를 만들어보자.



### 1. 기본 HTML 틀 만들기



`<ul>` 태그에는 아무것도 적지 않는다. 이는 JavaScript에서 추가해 줄 것이다.(중요하지 않은 부분은 생략)



```html
<form id = "todo-form">
    <input type="text" placeholder="Write a To Do and Press Enter" required/>
</form>
<ul id = "todo-list"></ul>
```



### 2. 기본 JS 틀 만들기



`submit` 이벤트가 발생했을 때 새로고침을 막아주고 `input value`를 새로운 변수에 저장해 준다. 그리고 `input value`는 다시 빈 공간으로 만들어 준다.



```javascript
const toDoForm = document.getElementById("todo-form");
const toDoInput = toDoForm.querySelector("input"); // = document.querySelector("#todo-form input")
const toDoList = document.getElementById("todo-list");

function handleToDoSubmit(event) {
    event.preventDefault();
    const newTodo = toDoInput.value; // 입력받은 값을 새로운 변수 newTodo에 저장해 준다.
    toDoInput.value = ""; // input value 값은 빈 공간으로 초기화 시켜준다.
}
toDoForm.addEventListener("submit", handleToDoSubmit);
```



### 3. input value를 리스트에 추가하기



리스트에 추가해 주는 것을 하나의 함수(paintToDo)로 만들어 작성해 주자. 이 때 newToDo를 인자로 전달한다. 그 후 JS로 HTML을 조작하는 과정이다.



```javascript
const toDoForm = document.getElementById("todo-form");
const toDoInput = toDoForm.querySelector("input");
const toDoList = document.getElementById("todo-list");

function paintToDo(newTodo) {
    const li = document.createElement("li"); // 2. <li> 태그를 만들어 변수에 저장
    const span = document.createElement("span"); // 3. <span> 태그를 만들어 변수에 저장
    li.appendChild(span); // 4. li의 자식에 span 추가
    span.innerText = newTodo; // 5. span의 innerText에 newTodo 삽입
    toDoList.appendChild(li); // 6. toDoList에 li를 자식으로 추가
}
function handleToDoSubmit(event) {
    event.preventDefault();
    const newTodo = toDoInput.value;
    toDoInput.value = "";
    paintToDo(newTodo); // 1. 리스트에 추가하기 위한 함수 호출
}
toDoForm.addEventListener("submit", handleToDoSubmit);
```



### 4. 리스트 삭제를 위한 버튼 만들기



기존의 `paintToDo` 함수에 삭제 버튼을 만들고 HTML을 조작하고, 삭제를 위한 함수를 만들어 `click` 이벤트가 발생할 시 실행되도록 해준다. 



그런데 이 때, `button`이 여러 개일 경우 `click` 이벤트가 어떤 것을 의미하는지 알 수가 없기 때문에 `event.target.parentElement`를 통해서 이벤트가 발생한 타깃의 부모요소인 `li`를 받고 삭제시켜 준다.




```javascript
const toDoForm = document.getElementById("todo-form");
const toDoInput = toDoForm.querySelector("input");
const toDoList = document.getElementById("todo-list");

function deleteToDo(event) {
    const li = event.target.parentElement; // 5. 클릭한 버튼에 해당하는 li를 찾아 변수에 저장.
    li.remove(); // 6. li 삭제
}

function paintToDo(newTodo) {
    const li = document.createElement("li");
    const span = document.createElement("span");
    const button = document.createElement("button"); // 1. <button> 태그를 만들어 변수에 저장
    button.innerText = "X"; // 2. button의 innerText에 "X" 문자 삽입
    button.addEventListener("click", deleteToDo); // 4. button을 클릭하는 이벤트 발생 시 리스트를 삭제시키는 함수 호출
    li.appendChild(span);
    li.appendChild(button); // 3. li의 자식에 button 추가
    span.innerText = newTodo;
    toDoList.appendChild(li);
}
function handleToDoSubmit(event) {
    event.preventDefault();
    const newTodo = toDoInput.value;
    toDoInput.value = "";
    paintToDo(newTodo);
}
toDoForm.addEventListener("submit", handleToDoSubmit);
```



### 5. 새로고침 시 초기화 방지



새로고침하게 되면 li가 전부 날아가게 되는 현상이 발생한다. 따라서 이전에 배운 `localStorage`를 이용하여 ToDo를 저장해 보자. 이 때 저장의 목적은 다시 불러오기 위함인데 `localStorage`에 저장될 때는 그저 `"text"`로 저장될 뿐이다(배열로 불가능). 



따라서 다시 불러오기 위해서 `JSON.stringify()` 메소드를 이용하여 `"배열의 모양을 띈 text"` 로 저장해 줄 것이다.  그리고 `JSON.parse()` 메소드로 `"배열의 모양을 띈 text"`를 `"배열"`로 바꾸어 loading할 것이다.



```javascript
const toDoForm = document.getElementById("todo-form");
const toDoInput = toDoForm.querySelector("input");
const toDoList = document.getElementById("todo-list");

let toDos = []; // 1. toDos 배열 생성

const TODOS_KEY = "todos"; // 4. localStorage의 key로 쓰일 변수가 반복되기에 대문자로 선언

function saveToDos() {
    localStorage.setItem(TODOS_KEY, JSON.stringify(toDos)); // 5. key의 해당하는 값에 toDos배열을 text로 저장
}

function deleteToDo(event) {
    const li = event.target.parentElement;
    li.remove();
}

function paintToDo(newTodo) {
    const li = document.createElement("li");
    const span = document.createElement("span");
    const button = document.createElement("button");
    button.innerText = "X";
    button.addEventListener("click", deleteToDo);
    li.appendChild(span);
    li.appendChild(button);
    span.innerText = newTodo;
    toDoList.appendChild(li);
}
function handleToDoSubmit(event) {
    event.preventDefault();
    const newTodo = toDoInput.value;
    toDoInput.value = "";
    toDos.push(newTodo); // 2. toDos 배열에 input value를 push해주기
    paintToDo(newTodo);
    saveToDos(); // 3. 저장을 위한 함수 호출
}
toDoForm.addEventListener("submit", handleToDoSubmit);

const savedToDos = localStorage.getItem(TODOS_KEY); // 6. localStorage에 저장된 값들을 savedToDos에 저장

if(savedToDos !== null) { // 7. savedToDos가 비어있지 않고 값이 있다면
    const parsedToDos = JSON.parse(savedToDos); // 8. 배열로 변환하여 parsedToDos에 저장
    toDos = parsedToDos; // 9. 새로고침 시에 toDos 배열이 초기화되는 것을 막기 위해 toDos 배열에 parsedToDos 저장
    parsedToDos.forEach(paintToDo); // 10. prasedToDos 배열의 각각 요소에 대하여 paintToDo 함수를 실행
}
```



여기까지 하면 새로고침 시에도 초기화 되지 않는 상태까지 구현 가능하다. 그러나 삭제 버튼을 눌렀을 시 HTML에서는 적용 되지만 `localStorage`에서는 적용이 되지 않고 있다. 즉 삭제를 하고 새로고침을 하면 삭제하기 이전 상태의 리스트로 돌아온다는 것이다. 이제 마지막으로 삭제에 대한 것도 `localStorage`에 적용해 주도록 하자.



### 6. 리스트 삭제 후 새로고침 시 초기화방지



삭제하고 싶은 요소를 `id`를 통해 구분하기 위해 `text`를 `push`하던 것을 `object`를 `push`하는 것으로 변경해 주자. 최종적으로는 `filter`를 이용하여 지우고 싶은 item을 제외시킬 것이다. `true`면 새로운 array에도 그 요소를 포함시키고 `false`가 `return`되면 그 요소는 제외시킨다.



```javascript
const toDoForm = document.getElementById("todo-form");
const toDoInput = toDoForm.querySelector("input");
const toDoList = document.getElementById("todo-list");

let toDos = [];

const TODOS_KEY = "todos";

function saveToDos() {
    localStorage.setItem(TODOS_KEY, JSON.stringify(toDos));
}

function deleteToDo(event) {
    const li = event.target.parentElement;
    li.remove();
    toDos = toDos.filter(toDo => toDo.id !== parseInt(li.id)); // 8. 삭제된 li의 id와 같은 요소는 toDos 배열에서 제외
    saveToDos(); // 9. 이 때 saveToDos 함수를 실행시키면 삭제된 것이 localStorage에 적용된다.
}

function paintToDo(newTodo) {
    const li = document.createElement("li");
    li.id = newTodo.id; // 6. li의 id를 전달 받은 객체의 id로 저장.(newTodoObj인자를 newTodo로 받은 상태)
    const span = document.createElement("span");
    span.innerText = newTodo.text; // 7. span의 innerText를 전달 받은 객체의 text로 저장.
    const button = document.createElement("button");
    button.innerText = "X";
    button.addEventListener("click", deleteToDo);
    li.appendChild(span);
    li.appendChild(button);
    toDoList.appendChild(li);
}
function handleToDoSubmit(event) {
    event.preventDefault();
    const newTodo = toDoInput.value;
    toDoInput.value = "";
    const newTodoObj = { // 1. text대신 object를 push하기 위해 객체 생성
        text:newTodo, // 2. text는 그대로 newTodo
        id: Date.now(), // 3. id는 고유한 값이어야 하므로 Date를 이용해 현재 시간으로 설정
    }
    toDos.push(newTodoObj); // 4. newTodoObj를 push
    paintToDo(newTodoObj); // 5. 인자로 newTodoObj를 전달
    saveToDos();
}
toDoForm.addEventListener("submit", handleToDoSubmit);

const savedToDos = localStorage.getItem(TODOS_KEY);

if(savedToDos !== null) {
    const parsedToDos = JSON.parse(savedToDos);
    toDos = parsedToDos;
    parsedToDos.forEach(paintToDo);
}
```



> 이 포스팅은 노마드코더 클론코딩 강의를 기반으로 재구성하였습니다.